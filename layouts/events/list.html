{{ define "main" }}
{{/*
  Events list page - shows non-expired events sorted by date, paginated
*/}}

{{ .Scratch.Set "scope" "list" }}

{{/* Header */}}
<header>
  {{ if .Params.showBreadcrumbs | default (site.Params.list.showBreadcrumbs | default false) }}
    {{ partial "breadcrumbs.html" . }}
  {{ else }}
    <div class="h-5"></div>
  {{ end }}
  <h1 class="mt-5 text-4xl font-extrabold text-neutral-900 dark:text-neutral">{{ .Title }}</h1>
</header>

{{/* Filter expired events and sort by date (soonest first) */}}
{{ $allPages := .Pages }}
{{ $activeEvents := partial "filter-active-events.html" (dict "pages" $allPages) }}
{{ $sortedEvents := sort $activeEvents ".Date" "asc" }}

{{/* Paginate the filtered and sorted events */}}
{{ $paginator := .Paginate $sortedEvents }}

{{/* Events list */}}
{{ if gt (len $paginator.Pages) 0 }}
  <section class="mt-6 w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
    {{ range $paginator.Pages }}
      {{ partial "event-card.html" (dict "page" . "showSourceBadge" true) }}
    {{ end }}
  </section>
{{/* else: no active events */}}
{{ else }}
  <section class="mt-10 prose dark:prose-invert">
    <p class="py-8 border-t">
      <em>{{ i18n "list.no_articles" | default "Aucun événement à venir" | emojify }}</em>
    </p>
  </section>
{{ end }}
{{ partial "pagination.html" . }}
{{ end }}
